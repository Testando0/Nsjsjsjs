<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Image Gen - Estável</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #0a0a0c; color: #00d4ff; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .box { background: #15151a; border: 2px solid #00d4ff; padding: 25px; border-radius: 10px; width: 100%; max-width: 500px; box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); }
        button { width: 100%; padding: 15px; background: #00d4ff; color: #000; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; }
        button:hover { background: #008fb3; }
        #log { margin-top: 15px; font-size: 12px; color: #ff0055; font-weight: bold; }
        pre { background: #000; padding: 15px; border-radius: 5px; overflow: auto; font-size: 11px; color: #fff; border: 1px solid #333; height: 150px; }
        #imageResult img { width: 100%; margin-top: 20px; border-radius: 8px; border: 1px solid #00d4ff; }
    </style>
</head>
<body>

<div class="box">
    <h2 style="text-align:center">GEMINI CLOUD GENERATOR</h2>
    <button id="btn">EXECUTAR REQUEST</button>
    <div id="log">Status: Aguardando...</div>
    <pre id="output">Os dados aparecerão aqui...</pre>
    <div id="imageResult"></div>
</div>

<script>
    document.getElementById('btn').addEventListener('click', async () => {
        const log = document.getElementById('log');
        const output = document.getElementById('output');
        const imageResult = document.getElementById('imageResult');
        const btn = document.getElementById('btn');

        btn.disabled = true;
        log.style.color = "#00d4ff";
        log.innerText = "Status: Ignorando bloqueios de rede...";
        output.innerText = "Conectando ao AllOrigins Proxy...";

        const targetUrl = 'https://api.felo.ai/v1/gemini-image-gen';
        const payload = {
            "prompt": "A cyberpunk city at night, neon signs in Japanese, ultra detailed, 4k",
            "resolution": "2048x2048",
            "model": "gemini-3-pro-image-preview"
        };

        try {
            // Usamos o AllOrigins via POST para enviar o payload corretamente
            const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`, {
                method: 'GET' // AllOrigins funciona melhor como GET que encapsula o destino
            });

            // Nota Técnica: Se a API felo.ai exigir POST estrito com Body, 
            // navegadores sempre darão erro sem um servidor Node.js intermediário.
            // Vamos tentar o fetch direto com um cabeçalho de modo "no-cors" como última tentativa se falhar.
            
            const res = await fetch('https://api.codetabs.com/v1/proxy?quest=' + encodeURIComponent(targetUrl), {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer free' },
                body: JSON.stringify(payload)
            });

            if (!res.ok) throw new Error("Status: " + res.status);

            const data = await res.json();
            output.innerText = JSON.stringify(data, null, 2);
            log.innerText = "Status: Sucesso!";

            const url = data.url || (data.data && data.data[0]?.url);
            if (url) imageResult.innerHTML = `<img src="${url}">`;

        } catch (err) {
            log.style.color = "#ff0055";
            log.innerText = "Erro: " + err.message;
            output.innerText = "Possíveis causas:\n1. O Proxy está sobrecarregado.\n2. A API felo.ai bloqueou o IP do proxy.\n3. O endpoint exige HTTPS seguro e Bearer token válido.";
        } finally {
            btn.disabled = false;
        }
    });
</script>

</body>
</html>
